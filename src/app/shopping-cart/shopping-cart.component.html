<!-- Business Services Section -->
<div class="business-services-section" *ngIf="businessInfo">
  <p-card subheader="{{businessInfo.businessName}}" styleClass="business-info-card">
    <p class="business-description">{{businessInfo.businessDescription}}</p>
    
    <div class="business-contact-info">
      <p-chip *ngIf="businessInfo.phone" icon="pi pi-phone" label="{{businessInfo.phone}}"></p-chip>
      <p-chip *ngIf="businessInfo.email" icon="pi pi-envelope" label="{{businessInfo.email}}"></p-chip>
    </div>
    
    <p-divider align="center">
      <p-chip label="Services" icon="pi pi-shopping-cart"></p-chip>
    </p-divider>
    
    <div *ngIf="isLoadingBusinessData" class="loading-container">
      <p-progressSpinner styleClass="custom-spinner"></p-progressSpinner>
      <p>Loading business services...</p>
    </div>
    
    <div *ngIf="!isLoadingBusinessData && businessServices.length > 0" class="services-grid">
      <p-card *ngFor="let service of businessServices" styleClass="service-card">
        <ng-template pTemplate="header">
          <img *ngIf="service.serviceImageUrl" [src]="service.serviceImageUrl" alt="Service Image" class="service-image">
          <div *ngIf="!service.serviceImageUrl" class="service-image-placeholder">
            <i class="pi pi-image"></i>
          </div>
        </ng-template>
        
        <ng-template pTemplate="title">
          <span class="service-name">{{service.serviceName}}</span>
        </ng-template>
        
        <ng-template pTemplate="subtitle">
          <div class="service-details">
            <p-tag severity="info" icon="pi pi-clock" value="{{service.duration}} min"></p-tag>
            <p-tag severity="success" icon="pi pi-dollar" value="{{service.price | currency:service.currency}}"></p-tag>
          </div>
        </ng-template>
        
        <p class="service-description">{{service.serviceDescription}}</p>
        
        <ng-template pTemplate="footer">
          <div class="service-actions">
            <p-button 
              *ngIf="!isServiceInCart(service)" 
              label="Add to Cart" 
              icon="pi pi-cart-plus" 
              (onClick)="addServiceToCart(service)"
              styleClass="p-button-sm">
            </p-button>
            
            <div *ngIf="isServiceInCart(service)" class="quantity-controls">
              <p-button 
                icon="pi pi-minus" 
                (onClick)="decrementServiceQuantity(service)" 
                styleClass="p-button-sm p-button-outlined"
                severity="secondary">
              </p-button>
              <p-chip [label]="getServiceQuantityInCart(service).toString()" styleClass="quantity-chip"></p-chip>
              <p-button 
                icon="pi pi-plus" 
                (onClick)="incrementServiceQuantity(service)" 
                styleClass="p-button-sm p-button-outlined"
                severity="secondary">
              </p-button>
            </div>
          </div>
        </ng-template>
      </p-card>
    </div>
    
    <p-message *ngIf="!isLoadingBusinessData && businessServices.length === 0" 
               severity="info" 
               text="No services available at this time.">
    </p-message>
  </p-card>
</div>

<!-- Shopping Cart Section -->
<div class="cart-container" *ngIf="dataService.CartItems.length > 0; else emptyCart">
  <p-card header="Your Service Cart" styleClass="cart-card">
    <p-table [value]="dataService.CartItems" styleClass="p-datatable-sm custom-cart-table">
      <ng-template pTemplate="header">
        <tr>
          <th>Image</th>
          <th>Service Name</th>
          <th>Unit Price</th>
          <th>Quantity</th>
          <th>Total</th>
          <th>Remove</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>
        <img [src]="item.service.serviceImageUrl" alt="Service Image" class="cart-table-img" *ngIf="item.service.serviceImageUrl" />
            <i class="pi pi-image" *ngIf="!item.service.serviceImageUrl" style="font-size: 2rem; color: #ccc;"></i>
      </td>
          <td><strong>{{ item.service.serviceName }}</strong></td>
          <td>{{ item.service.servicePrice | currency:item.service.servicePriceCurrencyUnit }}</td>
          <td>
            <div class="quantity-controls">
              <p-button 
                icon="pi pi-minus" 
                (onClick)="dataService.DecrementQuantity(item.service)" 
                styleClass="p-button-sm p-button-outlined"
                severity="secondary">
              </p-button>
        <span class="qty-value">{{ item.quantity }}</span>
              <p-button 
                icon="pi pi-plus" 
                (onClick)="dataService.IncrementQuantity(item.service)" 
                styleClass="p-button-sm p-button-outlined"
                severity="secondary">
              </p-button>
            </div>
      </td>
          <td>{{ (item.service.servicePrice || 0) * item.quantity | currency:item.service.servicePriceCurrencyUnit }}</td>
          <td>
            <p-button 
              icon="pi pi-trash" 
              (onClick)="dataService.RemoveFromCart(item.service)" 
              styleClass="p-button-sm p-button-danger"
              severity="danger">
            </p-button>
      </td>
        </tr>
      </ng-template>
    </p-table>

    <ng-template pTemplate="footer">
  <div class="cart-summary">
        <p-panel header="Order Summary" styleClass="cart-summary-panel">
    <div class="cart-summary-row">
      <span>Total Items:</span>
            <p-chip [label]="dataService.itemsInCart.toString()" styleClass="summary-chip"></p-chip>
    </div>
    <div class="cart-summary-row">
      <span>Total Price:</span>
            <p-chip [label]="(totalPrice | currency) || ''" styleClass="summary-chip price-chip"></p-chip>
          </div>
                      <div class="date-selection">
              <p>Select a date for your service(s)</p>
              <p-calendar 
                [(ngModel)]="selectedDate" 
                [minDate]="minDate" 
                dateFormat="mm/dd/yy" 
                placeholder="Choose a date"
                styleClass="date-picker"
                [showIcon]="true"
                [readonlyInput]="true">
              </p-calendar>
    </div>
          <p-button 
            label="Checkout" 
            icon="pi pi-shopping-cart" 
            (onClick)="CheckOutPessed()" 
            styleClass="checkout-btn p-button-lg"
            severity="success">
          </p-button>
        </p-panel>
  </div>
    </ng-template>
  </p-card>
</div>

<!-- Customer Details Form -->
<div class="customer-form-container" *ngIf="showCustomerForm">
  <mat-card class="customer-form-card">
    <mat-card-header>
      <mat-card-title>Customer Details</mat-card-title>
      <mat-card-subtitle>Please provide your information to complete the order</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="customerForm" (ngSubmit)="submitOrder()">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Full Name *</mat-label>
            <input matInput formControlName="name" placeholder="Enter your full name">
            <mat-error *ngIf="customerForm.get('name')?.hasError('required')">
              Name is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Email *</mat-label>
            <input matInput formControlName="email" placeholder="Enter your email" type="email">
            <mat-error *ngIf="customerForm.get('email')?.hasError('required')">
              Email is required
            </mat-error>
            <mat-error *ngIf="customerForm.get('email')?.hasError('email')">
              Please enter a valid email address
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Phone Number *</mat-label>
            <input matInput formControlName="phone" placeholder="Enter your phone number">
            <mat-error *ngIf="customerForm.get('phone')?.hasError('required')">
              Phone number is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Street Address *</mat-label>
            <input matInput formControlName="address" placeholder="Enter your street address">
            <mat-error *ngIf="customerForm.get('address')?.hasError('required')">
              Address is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>City *</mat-label>
            <input matInput formControlName="city" placeholder="Enter your city">
            <mat-error *ngIf="customerForm.get('city')?.hasError('required')">
              City is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>State/Province *</mat-label>
            <input matInput formControlName="state" placeholder="Enter your state or province">
            <mat-error *ngIf="customerForm.get('state')?.hasError('required')">
              State is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Postal Code *</mat-label>
            <input matInput formControlName="postalCode" placeholder="Enter your postal code">
            <mat-error *ngIf="customerForm.get('postalCode')?.hasError('required')">
              Postal code is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Selected Service Date</mat-label>
            <input matInput [value]="selectedDate | date:'MM/dd/yyyy'" readonly>
            <mat-hint>Date selected from the previous step</mat-hint>
            <mat-icon matSuffix>calendar_today</mat-icon>
          </mat-form-field>
        </div>

        <div class="order-summary">
          <h4>Order Summary</h4>
          <div class="summary-row">
            <span>Total Items:</span>
            <span>{{dataService.itemsInCart}}</span>
          </div>
          <div class="summary-row">
            <span>Total Price:</span>
            <span>{{totalPrice | currency}}</span>
          </div>
        </div>

        <div class="form-actions">
          <button mat-button type="button" (click)="cancelOrder()">Cancel</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!customerForm.valid">
            Submit Order
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>

<ng-template #emptyCart>
  <div class="empty-cart">
    <p-card styleClass="empty-cart-card">
      <ng-template pTemplate="header">
        <div class="empty-cart-icon">
          <i class="pi pi-shopping-cart" style="font-size: 4rem; color: #ccc;"></i>
        </div>
      </ng-template>
      
      <ng-template pTemplate="title">
    <h2>Your cart is empty</h2>
      </ng-template>
      
      <ng-template pTemplate="subtitle">
        <p>Browse our services below and add some to get started!</p>
      </ng-template>
      
      <ng-template pTemplate="footer">
        <div class="empty-cart-actions" *ngIf="businessServices.length > 0">
          <p-button 
            label="Browse Services" 
            icon="pi pi-arrow-up" 
            (onClick)="scrollToServices()"
            styleClass="p-button-outlined">
          </p-button>
        </div>
      </ng-template>
    </p-card>
  </div>
</ng-template>